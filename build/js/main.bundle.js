(()=>{"use strict";const e=document.querySelector(".img-filters"),t=(e,t)=>e<0||t<0?-1:(t<e&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1))+e),n=e=>"Escape"===e.key||"Esc"===e.key,r=()=>{const e=document.querySelector("body"),t=document.querySelector("#error").content.querySelector(".error");t.querySelector(".error__button").addEventListener("click",(()=>{t.remove()})),document.addEventListener("keydown",(e=>{n(e)&&t.remove()})),e.appendChild(t)},o=document.querySelector("body"),c=o.querySelector(".big-picture"),l=c.querySelector(".big-picture__img img"),s=c.querySelector(".social__caption"),a=c.querySelector(".likes-count"),i=c.querySelector(".comments-count"),d=c.querySelector(".social__comment-counter"),m=c.querySelector(".comments-loader"),u=c.querySelector(".big-picture__cancel"),y=c.querySelector(".social__comments"),p=document.querySelector("#comment").content;let g=5;const v=(e,t)=>r=>{n(r)&&(r.preventDefault(),_(e,t))},_=(e,t)=>{e.classList.add("hidden"),t.classList.remove("modal-open"),g=5,m.hidden=!1,m.removeEventListener("click",h),document.removeEventListener("keydown",v)};let h;const S=(e,t)=>{const n=document.createDocumentFragment();y.innerHTML="";for(let r=0;r<=t-1;r++){const t=p.cloneNode(!0),o=t.querySelector(".social__picture"),c=t.querySelector(".social__text");o.src=e[r].avatar,o.alt=e[r].name,c.textContent=e[r].message,n.appendChild(t)}y.appendChild(n)},f=e=>{l.src=e.url,s.textContent=e.description,a.textContent=e.likes,i.textContent=e.comments.length,e.comments.length<=5?(S(e.comments,e.comments.length),d.textContent=e.comments.length,m.hidden=!0):(S(e.comments,g),d.textContent=g),((e,t,n,r)=>{var o;n.classList.add("modal-open"),t.addEventListener("click",(()=>{_(e,n),t.removeEventListener("click",_)})),o=r.comments,h=()=>{g+=5;const e=o.slice(0,g);g<=o.length?(S(e,g),d.textContent=g):(m.hidden=!0,S(o,o.length),d.textContent=o.length)},document.addEventListener("keydown",v(e,n)),m.addEventListener("click",h),e.classList.remove("hidden")})(c,u,o,e)},q=document.querySelector("#picture").content,L=document.querySelector(".pictures"),x=e=>{const t=q.cloneNode(!0),n=t.querySelector(".picture__img"),r=t.querySelector(".picture__comments"),o=t.querySelector(".picture__likes");return n.src=e.url,r.textContent=e.comments.length,o.textContent=e.likes,t},k=e=>{const t=document.createDocumentFragment();for(let n=0;n<=e.length-1;n++)t.appendChild(x(e[n]));L.appendChild(t);for(let t=0;t<=e.length-1;t++)L.querySelectorAll("a")[t].addEventListener("click",(n=>{n.preventDefault(),f(e[t])}))},E=document.querySelector(".img-filters__form"),b=()=>{document.querySelector(".pictures").querySelectorAll("a").forEach((e=>e.remove()))},C=e=>{E.querySelectorAll("button").forEach((e=>{e.classList.remove("img-filters__button--active")})),e.classList.add("img-filters__button--active")},w=e=>n=>{"filter-default"===n.target.id&&((e,t)=>{b(),C(e),k(t)})(n.target,e),"filter-random"===n.target.id&&((e,n)=>{C(e);const r=((e,n,r)=>{let o=[];if(n-0+1<10)return-1;for(;o.length<10;){const e=t(0,n);o.includes(e)||o.push(e)}return o})(0,n.length-1).map((e=>n.slice()[e]));b(),k(r)})(n.target,e),"filter-discussed"===n.target.id&&((e,t)=>{C(e);const n=t.slice().sort(((e,t)=>t.comments.length-e.comments.length));b(),k(n)})(n.target,e)},D=document.querySelector(".img-upload__preview img"),A=document.querySelector(".img-upload__form"),$=document.querySelector(".effect-level__slider"),T=document.querySelector(".effect-level__value"),U=A.querySelector("#effect-none"),F=A.querySelector(".img-upload__effect-level"),j=[{name:"none",min:0,max:100,step:1},{name:"chrome",style:"grayscale",min:0,max:1,step:.1,unit:""},{name:"sepia",style:"sepia",min:0,max:1,step:.1,unit:""},{name:"marvin",style:"invert",min:0,max:100,step:1,unit:"%"},{name:"phobos",style:"blur",min:0,max:3,step:.1,unit:"px"},{name:"heat",style:"brightness",min:1,max:3,step:.1,unit:""}],z=j[0];let M=z;const N=()=>M===z,P=()=>{F.classList.remove("hidden"),$.noUiSlider.updateOptions({range:{min:M.min,max:M.max},step:M.step,start:M.max}),N()&&F.classList.add("hidden")};window.noUiSlider.create($,{range:{min:z.min,max:z.max},start:z.max,step:z.step,connect:"lower"}),P(),A.addEventListener("change",(e=>{e.target.classList.contains("effects__radio")&&(M=j.find((t=>t.name===e.target.value)),P())})),$.noUiSlider.on("update",(()=>{if(D.style.filter="none",D.className="",N())return;const e=$.noUiSlider.get();D.style.filter=`${M.style}(${e}${M.unit})`,D.classList.add(`effects-preview--${M.name}`),T.value=e}));const O=document.querySelector(".scale__control--smaller"),R=document.querySelector(".scale__control--bigger"),H=document.querySelector(".scale__control--value"),V=document.querySelector(".img-upload__preview img"),W=document.querySelector(".img-upload__form"),Z=document.querySelector("#upload-file"),B=document.querySelector(".img-upload__overlay"),G=document.querySelector("#upload-cancel"),I=document.querySelector("body"),J=document.querySelector(".text__hashtags"),K=document.querySelector(".text__description"),Q=()=>{B.classList.add("hidden"),I.classList.remove("modal-open"),Z.value="",H.value="100%",V.style.transform="scale(1)",M=z,U.checked=!0,P(),W.reset()},X=e=>{n(e)&&document.activeElement!==J&&document.activeElement!==K&&(e.preventDefault(),Q())},Y=document.querySelector("#upload-file"),ee=document.querySelector(".img-upload__preview img");Y.addEventListener("change",(e=>{const t=e.target,n=new FileReader;n.addEventListener("load",(function(){ee.src=n.result})),n.readAsDataURL(t.files[0]),(()=>{let e=100;H.value=e+"%",O.addEventListener("click",(()=>{var t;(t=e)>25&&t<=100&&(t-=25),e=t,H.value=e+"%",V.style.transform=`scale(0.${e})`})),R.addEventListener("click",(()=>{var t;(t=e)>=25&&t<100&&(t+=25),e=t,H.value=e+"%",V.style.transform=100!==e?`scale(0.${e})`:"scale(1)"}))})(),G.addEventListener("click",Q),document.addEventListener("keydown",X),I.classList.add("modal-open"),B.classList.remove("hidden")}));const te=document.querySelector(".img-upload__form"),ne=document.querySelector(".text__hashtags"),re=/[^a-zA-Z0-9а-яА-ЯёЁ]/g,oe=new Pristine(te,{classTo:"img-upload__element",errorTextParent:"img-upload__element",errorTextClass:"img-upload__error"}),ce=e=>{return"#"===e[0]&&((t=e).length>=2&&t.length<=20)&&(e=>!re.test(e.slice(1)))(e);var t};oe.addValidator(ne,(e=>{const t=e.trim().split(" ").filter((e=>e.trim().length));return(e=>e.length<=5)(t)&&(e=>{const t=e.map((e=>e.toLowerCase()));return t.length===new Set(t).size})(t)&&t.every(ce)}),"Неправильно заполнены хэштеги");const le=()=>{Q(),(()=>{const e=document.querySelector("body"),t=document.querySelector("#success").content.querySelector(".success");t.querySelector(".success__button").addEventListener("click",(()=>{t.remove()})),document.addEventListener("keydown",(e=>{n(e)&&t.remove()})),e.appendChild(t)})()};var se,ae,ie;te.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);oe.validate()&&((e,t,n)=>{fetch("https://23.javascript.pages.academy/kekstagram",{method:"POST",body:n}).then((n=>{n.ok||t(),e()})).catch((()=>t()))})(le,r,t)})),se=k,ae=()=>{const e=document.querySelector("body"),t=document.createElement("div");t.textContent="Ошибка загрузки данных. Пожалуйста, перезагрузите страницу.",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.padding="16px 0 16px 0",t.style.backgroundColor="white",t.style.fontSize="28px",t.style.fontWeight="700",t.style.textAlign="center",t.style.color="#232321",e.appendChild(t)},ie=e=>{E.addEventListener("click",w(e))},fetch("https://23.javascript.pages.academy/kekstagram/data").then((t=>{if(t.ok)return e.classList.remove("img-filters--inactive"),t.json();ae()})).then((e=>{se(e),ie(e)})).catch((()=>ae()))})();
//# sourceMappingURL=main.bundle.js.map